---
title: "eneRgyVD: profil énergétique"
subtitle: "Direction générale de l'environnement - Direction de l'énergie (DGE-DIREN)"
author: "Unité Données Indicateurs"
date: "`r Sys.Date()`"
always_allow_html: yes
output:
  html_document:
    code_folding: hide
    df_print: paged
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: TRUE
    code_download: TRUE
fontsize: 11pt

#bibliography: references.bib

#paramètres pour l'export Shiny (cons_data removed temporarily)
params:
  communes: NULL
  web_height: NULL
  web_width: NULL
  unit: NULL
  prod_data: NULL
  regener_data_0: NULL
  regener_data_1: NULL
  regener_data_2: NULL
  regener_data_3: NULL
  
---

```{r setup, include=FALSE}
# Basic knitr behavior
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, comment = 'Note:')


```

```{css basic-theme, echo = FALSE}
.main-container {
    margin-left: 30px;
}

.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: white;
    background-color: darkgreen;
    border-color: white;
}

h2,h3,h4,h5,h6{
  font-size: 13pt;
  color:midnightblue;
}

h1{
font-size:14pt;
color:midnightblue;
}
```

Ce rapport a été généré depuis l'application [stat-energie-vd.ch](https://stat-energie-vd.ch/).

Le contenu de ce rapport sera adapté progressivement en fonction des données disponibles ainsi que des fonctionnalités souhaitées par les utilisateurs.

# Rapport énergétique

Ce rapport a été généré pour `r knitr::combine_words(words = params$communes,sep = ", ",and = " et ",oxford_comma = F)`.

<!-- ## Consommation d'électricité -->

<!-- ### Tableau -->

<!-- ```{r} -->
<!-- params$cons_data |> -->
<!--   eneRgyVD::create_cons_table_dt(unit = params$unit) -->
<!-- ``` -->

<!-- ### Graphique -->

<!-- ```{r} -->

<!-- params$cons_data |> -->
<!--     eneRgyVD::create_bar_plotly(unit = params$unit, -->
<!--                                 n_communes = length(params$communes), -->
<!--                                 web_width = params$web_width, -->
<!--                                 web_height = params$web_height, -->
<!--                                 var_year = "annee", -->
<!--                                 var_commune = "commune", -->
<!--                                 var_rank_2 = "secteur", -->
<!--                                 var_values = "consommation", -->
<!--                                 color_palette = eneRgyVD::return_palette_cons_elec(), -->
<!--                                 dodge = F, -->
<!--                                 free_y = F, -->
<!--                                 legend_title = "Secteurs") -->

<!-- ``` -->


## Production d'électricité

### Tableau

```{r}

params$prod_data |> 
    eneRgyVD::create_prod_table_dt(unit = params$unit)

```

### Graphique

```{r}

params$prod_data |>
    eneRgyVD::create_bar_plotly(unit = params$unit,
                                n_communes = length(params$communes),
                                web_width = params$web_width,
                                web_height = params$web_height,
                                var_year = "annee",
                                var_commune = "commune",
                                var_rank_2 = "categorie",
                                var_values = "production",
                                color_palette = eneRgyVD::return_palette_prod_elec(),
                                dodge = F,
                                free_y = F,
                                legend_title = "Technologies")

```

## Chaleur des bâtiments

### Tableaux

Par usage : 

```{r}

params$regener_data_1 |>
  eneRgyVD::create_regener_table_dt(unit = params$unit)

```


Par affectation :

```{r}

params$regener_data_2 |>
  eneRgyVD::create_regener_table_dt(unit = params$unit)

```


### Graphiques

```{r}
# Use # of communes so that some plot chunk's height can be sized accordingly
# # 400 being default px for 1 row, 0.0104 is the approx conversion from px to inch
height_facet_plots = ceiling(length(params$communes)/2)*400*0.01
```



```{r fig.height= height_facet_plots, fig.width = 12}

params$regener_data_1 |>
  eneRgyVD::lump_alluvial_factors(var_commune = "commune",
                                var_flow = "consommation",
                                var_from = "ae",
                                var_to = "usage") |>
  eneRgyVD::create_alluvial_chart(var_commune = "commune",
                                  var_flow = "consommation",
                                  var_from = "ae",
                                  label_from = "Consommation",
                                  var_to = "usage",
                                  label_to = "Usage")

```



# Contact

Pour tout problème, suggestion d'amélioration ou remarque, n'hésitez pas à prendre contact avec le service en charge de ce projet :

DGE-DIREN, [stat.energie@vd.ch](mailto:stat.energie@vd.ch)









